import{j as e,r as h,R as j}from"./react-5a14d1f0.js";import{c as U}from"./react-dom-8f0dfa0a.js";import{D as p,I as G}from"./luxon-91c18b66.js";import{F as L,G as J,B as _,a as q}from"./react-icons-1a5cf1b9.js";import{C as K}from"./react-loading-icons-8836a31d.js";import{L as b,B as X}from"./react-router-dom-c2931411.js";import{d as z,e as R,f as y}from"./react-router-b1e149b2.js";import"./scheduler-04ce0582.js";import"./@remix-run-963a0ed9.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();function E(n,s,t,c){return e.jsxs("div",{title:c,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:n}),e.jsx("div",{className:"date-container-date",children:s}),e.jsx("div",{className:"date-container-msg",children:t})]})}const k=n=>{const s=p.now(),t=n.date,c=n.title,a="N/A",r="-";let l="Date not yet available";if(t==null)return E(c,a,r,l);try{const d=p.fromISO(t),v=p.now(),o=G.fromDateTimes(d,s);let f;o.length("days")>3?f=Math.floor(o.length("days"))+" days ago":o.length("hours")>3?f=Math.floor(o.length("hours"))+" hours ago":o.length("minutes")>3?f=Math.floor(o.length("minutes"))+" min. ago":f=Math.floor(o.length("seconds"))+" sec. ago";let m=d.toFormat("yyyy-LL-dd HH:mm:ss");return d.toFormat("yyyy-LL-dd")===v.toFormat("yyyy-LL-dd")&&(m=d.toFormat("HH:mm:ss")),l="Iso date: "+d.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),E(c,m,f,l)}catch(d){return E(c,"error",`${d}`,`${d}`)}};const O=h.createContext(null),P=()=>h.useContext(O),B=()=>{const n=P();if(n==null)throw new Error("Config not available");return n},I="http://localhost:8080",Q=({children:n})=>{const[s,t]=h.useState(null);return h.useEffect(()=>{(async()=>{const a=await(await fetch(`${I}/config`)).json();t(a.config)})()},[]),e.jsx(O.Provider,{value:s,children:n})};const F=n=>{const s=B(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId,c=s.chainSetup[t];if(!c)return e.jsxs("span",{children:["No ",t," in config"]});let a=n.contractAddress,r=`contract id: ${n.contractAddress}`;return n.isAddress&&(r=`address id: ${n.contractAddress}`),n.isAddress==="Receiver id"&&(r=`Receiver id: ${n.contractAddress}`),c.multiContractAddress===n.contractAddress&&(a="Multi payment contract"),c.glmAddress===n.contractAddress&&(a=`${c.currencyGlmSymbol} token`),e.jsx("a",{href:c.blockExplorerUrl,title:r,children:e.jsxs("div",{className:"contract-details-contract",children:[e.jsx(L,{className:"contract-details-contract-icon"}),e.jsx("div",{className:"contract-details-contract-name",children:a})]})})};function C(n){return typeof n=="string"&&(n=BigInt(n)),n=n/BigInt("1000000000000000000"),n.toString()}const V=n=>{const s=n.transfer;return e.jsxs("div",{className:"transfer-box",children:[e.jsx("div",{className:"transfer-id",title:"Transfer db id",children:s.id}),e.jsx("div",{className:"transfer-receiver",title:"Receiver address",children:e.jsx(F,{contractAddress:s.receiverAddr,chainId:s.chainId,isAddress:"Receiver id"})}),e.jsxs("div",{className:"transfer-token",title:"Tokens transferred",children:[C(s.tokenAmount)," ",n.tokenSymbol]})]})},W=n=>{const[s,t]=h.useState(null),c=B();if(j.useEffect(()=>{console.log("Loading transfers for tx "+n.tx_id),(async()=>{if(n.tx_id){const A=await(await fetch(`http://127.0.0.1:8080/transfers/${n.tx_id}`)).json();t(A)}})().then(()=>{console.log("Loaded transfers for tx "+n.tx_id)})},[n.tx_id]),s===null)return e.jsx("div",{children:"Loading..."});const a=s.transfers.length??0;let r=BigInt(0);const l=new Set;for(let u=0;u<a;u++)r+=BigInt(s.transfers[u].tokenAmount),l.add(s.transfers[u].receiverAddr);const d=r.toString();if(a===0)return e.jsxs("div",{className:"transfers-box",children:[e.jsx("div",{className:"transfers-box-header",children:"No transfers related to this transactions"}),e.jsx("div",{className:"transfers-box-content"})]});const v=s.transfers[0].tokenAddr,o=s.transfers[0].chainId,f=typeof o=="string"?parseInt(o):o;let m="???";v==null?m=c.chainSetup[f].currencyGasSymbol:c.chainSetup[f].glmAddress===v&&(m=c.chainSetup[f].currencyGlmSymbol);const i=C(d),x=(u,w)=>e.jsx(V,{transfer:u,tokenSymbol:m},w);return e.jsxs("div",{className:"transfers-box",children:[e.jsxs("div",{className:"transfers-box-header",children:[a," transfers to ",l.size," distinct addresses for a sum of ",i," ",m,":"," "]}),e.jsx("div",{className:"transfers-box-content",children:s.transfers.map(x)})]})};const H=n=>{const s=B(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId;if(t==null)return e.jsx("div",{children:"Unknown chain"});const c=s.chainSetup[t];return c?e.jsx("a",{href:c.blockExplorerUrl,title:`chain id: ${n.chainId}`,children:e.jsxs("div",{className:"chain-details-chain",children:[e.jsx(L,{className:"chain-details-chain-icon"}),e.jsx("div",{className:"chain-details-chain-name",children:c.chainName})]})}):e.jsxs("span",{children:["No ",t," in config"]})};const Z=n=>{const s=B(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId,c=s.chainSetup[t];return c?e.jsx("a",{href:c.blockExplorerUrl,title:`Transaction hash: ${n.transactionHash}`,children:e.jsxs("div",{className:"transaction-details-transaction",children:[e.jsx(L,{className:"transaction-details-transaction-icon"}),e.jsx("div",{className:"transaction-details-transaction-name",children:n.transactionHash})]})}):e.jsxs("span",{children:["No ",t," in config"]})},Y=n=>{const s=n.tx;if(s==null)return e.jsx("div",{className:"tx-container-wrapper"});let t=null;s.feePaid&&(t=C(s.feePaid));function c(){fetch(`http://127.0.0.1:8080/tx/skip/${n.tx_id}`,{method:"POST"}).then(l=>{console.log(l)})}function a(){return s.confirmDate!=null&&s.error==null&&s.engineError==null?e.jsx(J,{className:"tx-ok-icon"}):s.engineError!=null?e.jsx(_,{className:"tx-error-icon"}):s.error!=null?e.jsx(_,{className:"tx-error-icon"}):s.engineMessage?e.jsx(K,{className:"tx-loading",fill:"#000000"}):e.jsx(q,{className:"tx-wait-icon"})}function r(){return s.engineMessage?e.jsx("button",{onClick:c,children:"Skip transaction"}):e.jsx(e.Fragment,{})}return e.jsxs("div",{className:"tx-container-wrapper",children:[e.jsx("div",{className:"tx-container-header"}),e.jsxs("div",{className:"tx-container",children:[e.jsxs("div",{className:"tx-id",children:["db id: ",s.id]}),e.jsx("div",{className:"chain-id",children:e.jsx(H,{chainId:s.chainId})}),e.jsx("div",{className:"tx-method",title:"method",children:s.method}),e.jsx("div",{className:"tx-created",children:e.jsx(k,{title:"queued",date:s.createdDate})}),e.jsx("div",{className:"tx-from",children:e.jsx(F,{isAddress:!0,chainId:s.chainId,contractAddress:s.fromAddr})}),e.jsx("div",{className:"tx-from-descr",children:"From"}),e.jsx("div",{className:"tx-to",children:e.jsx(F,{isAddress:!1,chainId:s.chainId,contractAddress:s.toAddr})}),e.jsx("div",{className:"tx-to-descr",children:"To"}),e.jsx("div",{className:"tx-broadcast",children:e.jsx(k,{title:"broadcast",date:s.broadcastDate})}),e.jsx("div",{className:"tx-confirmed",children:e.jsx(k,{title:"confirmed",date:s.confirmDate})}),s.txHash?e.jsxs("div",{className:"tx-hash",children:[e.jsx("span",{}),e.jsx(Z,{chainId:s.chainId,transactionHash:s.txHash})]}):e.jsx("div",{className:"tx-hash tx-hash-unknown",children:"Tx hash - not available"}),s.nonce?e.jsxs("div",{className:"tx-nonce",children:["nonce: ",s.nonce]}):e.jsx("div",{className:"tx-nonce tx-nonce-unknown",children:"nonce: N/A"}),s.gasLimit?e.jsxs("div",{className:"tx-gas-limit",children:["gas limit: ",s.gasLimit]}):e.jsx("div",{className:"tx-gas-limit tx-gas-limit-unknown",children:"gas limit: N/A"}),s.feePaid?e.jsxs("div",{className:"tx-fee",children:["fee paid: ",t]}):e.jsx("div",{className:"tx-fee tx-fee-unknown",children:"fee paid: N/A"}),e.jsx("div",{className:"tx-processing",children:a()}),e.jsxs("div",{className:"tx-message",children:[r(),s.engineMessage," ",e.jsxs("span",{className:"tx-message-error",children:[s.engineError," ",s.error]})]})]}),e.jsx("div",{className:"tx-transfers",children:e.jsx(W,{tx_id:s.id})})]})},T=10,ee=()=>{const[n,s]=j.useState(0),[t,c]=j.useState(null),a=h.useCallback(i=>{i!=null?(i.length>=T&&(i[T-1].opacity=0,i[T-1].maxHeight=0),c(i.slice(0,T))):c(i)},[]),[r,l]=j.useState(null),d=h.useCallback(async()=>{const x=await(await fetch("http://127.0.0.1:8080/transactions/count")).json();l(x)},[]),v=h.useCallback(async()=>{const u=(await(await fetch("http://127.0.0.1:8080/transactions/feed/5/2")).json()).txs.slice().reverse().map(w=>({data:w}));if(t==null){a(u);return}else{const w=t.slice(),A=[];for(const g of u){const N=g.data;let $=-1;for(let S=0;S<t.length;S++)if(t[S].data.id===N.id){$=S;break}$===-1?(g.opacity=0,g.maxHeight=0,A.push(g)):w[$].data=N}if(A.length>0){const g=[...A,...w];a(g),await new Promise(N=>setTimeout(N,100));for(const N of g)N.opacity=1,N.maxHeight=500;a(g.slice())}}},[t,a]),o=h.useCallback(async()=>{const i=v(),x=d();await Promise.all([i,x]),await new Promise(u=>setTimeout(u,5e3))},[v,d]);j.useEffect(()=>{console.log("Refreshing dashboard..."),o().then(()=>{s(n+1)})},[o,n]);const f=i=>{const x=i.opacity??1,u=i.maxHeight??200;return e.jsx("div",{style:{opacity:x,maxHeight:u},className:"tx-wrapper",children:e.jsx(Y,{tx_id:i.data.id,tx:i.data})},i.data.id)};let m=0;if(t)for(const i of t)(i.opacity===void 0||i.opacity>0)&&m++;return e.jsxs("div",{children:[e.jsx("h3",{children:"Transaction feed"}),e.jsxs("div",{children:["Displaying ",m," transactions out of ",r==null?void 0:r.txDone," finished transaction and"," ",r==null?void 0:r.txQueued," queued"]}),t!=null?e.jsx("div",{className:"tx-33",children:t.map(f)}):e.jsx("div",{children:"Loading..."})]})};const D=n=>{if(n.allowance==null)return e.jsx("div",{children:"Unknown allowance"});const s=BigInt(n.allowance.allowance),t=BigInt("0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"),c=C(n.allowance.allowance),a=s>t?"Unlimited":c;return e.jsx("div",{className:"allowance-box",children:e.jsxs("div",{className:"allowance-box-body",children:[e.jsxs("div",{className:"allowance-id",children:["Allowance no ",n.allowance.id]}),e.jsx("div",{className:"allowance-owner",children:e.jsx(F,{isAddress:!0,chainId:n.allowance.chainId,contractAddress:n.allowance.owner})}),e.jsx("div",{className:"allowance-owner-descr",children:e.jsx("span",{children:"Owner/Account"})}),e.jsx("div",{className:"allowance-chain-id",children:e.jsx(H,{chainId:n.allowance.chainId})}),e.jsx("div",{className:"allowance-confirm-date",children:e.jsx(k,{date:n.allowance.confirmDate,title:"Confirmed Date"})}),e.jsxs("div",{className:"allowance-tx-id",children:["txid: ",n.allowance.txId]}),e.jsx("div",{className:"allowance-spender",children:e.jsx(F,{isAddress:!1,chainId:n.allowance.chainId,contractAddress:n.allowance.spender})}),e.jsx("div",{className:"allowance-spender-descr",children:e.jsx("span",{children:"Spender"})}),e.jsx("div",{className:"allowance-token-addr",children:e.jsx(F,{isAddress:!1,chainId:n.allowance.chainId,contractAddress:n.allowance.tokenAddr})}),e.jsx("div",{className:"allowance-allowance",title:c,children:e.jsxs("span",{children:["Spending allowed: ",a]})})]})})},ne=n=>{const[s,t]=j.useState(null),c=h.useCallback(async()=>{const l=await(await fetch(`${I}/account/${n.account}`)).json();t(l)},[n.account]);j.useEffect(()=>{c().then()},[c]);function a(r,l){return e.jsx("div",{children:e.jsx(D,{allowance:r})},l)}return s===null?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"account-box",children:[e.jsxs("div",{className:"account-box-header",children:["Account ",n.account]}),e.jsxs("div",{className:"account-box-body",children:[e.jsx("div",{children:JSON.stringify(s)}),e.jsx("div",{children:s.allowances.map(a)})]})]})},se=()=>{const[n,s]=j.useState(null),t=h.useCallback(async()=>{const r=await(await fetch(`${I}/accounts`)).json();s(r)},[]);function c(a,r){return e.jsx(ne,{account:a},r)}return h.useEffect(()=>{t().then()},[t]),e.jsxs("div",{children:[e.jsx("h1",{children:"Accounts"}),n==null?void 0:n.publicAddr.map(c),JSON.stringify(n)]})},te=()=>{const n={allowance:"115792089237316195423570985008687907853269984665640564039457584007913129639935",chainId:987789,confirmDate:"2022-12-23T13:37:47.827436700Z",error:null,feePaid:null,id:9,owner:"0x001066290077e38f222cc6009c0c7a91d5192303",spender:"0xbcfe9736a4f5bf2e43620061ff3001ea0d003c0f",tokenAddr:"0xec9f23c207018a444f9351df3d7937f609870667",txId:null},s={allowance:"12200000000000000000",chainId:987789,confirmDate:null,error:null,feePaid:null,id:10,owner:"0x101066290077e28f222cc6009c0c7a91d5192303",spender:"0xbcfe9736a4f5bf2e43620061ff3001ea0d003c0f",tokenAddr:"0xef9f23c207018a444f9351df3d7937f609870667",txId:null};return e.jsx("div",{children:e.jsxs("div",{className:"padding",children:[e.jsx("h1",{children:"Allowance box design time"}),e.jsx(D,{allowance:n}),e.jsx(D,{allowance:s})]})})},ae=()=>{const[n,s]=j.useState(null),t=h.useCallback(async()=>{const r=await(await fetch(`${I}/allowances`)).json();s(r)},[]);function c(a,r){return e.jsx(D,{allowance:a},r)}return h.useEffect(()=>{t().then()},[t]),e.jsxs("div",{children:[e.jsx("h1",{children:"Allowances"}),n==null?void 0:n.allowances.map(c),JSON.stringify(n)]})},ce=n=>{let s="Unknown entry";return n.event.transferIn!==null?s="Transfer in":n.event.chainTransfer!==null&&(s="Chain transfer"),e.jsx("div",{children:e.jsxs("span",{children:[s," ",n.event.date.toJSDate().toISOString()," ",n.event.transferred.toString()," - balance:"," ",n.event.balance.toString()]})})},re=()=>{const{account:n}=z(),[s,t]=j.useState(null),c=h.useCallback(async()=>{const l=await(await fetch(`${I}/account/${n}/in`)).json(),d=l.chainTransfers,v=l.transfersIn,o=[];for(const i of d){const x={id:`chain_transfer_${i.id}`,date:p.fromISO(i.blockchainDate),chainTransfer:i,transferIn:null,transferred:BigInt(i.tokenAmount),balance:BigInt(0)};o.push(x)}for(const i of v){const x={id:`transfer_in_${i.id}`,date:p.fromISO(i.requestedDate),chainTransfer:null,transferIn:i,transferred:-BigInt(i.tokenAmount),balance:BigInt(0)};o.push(x)}o.sort((i,x)=>i.date.toMillis()-x.date.toMillis());const f=o.find(i=>i.transferIn!=null);if(f!=null){const i=o.indexOf(f);o.splice(0,i)}let m=BigInt(0);for(const i of o)m+=i.transferred,i.balance=m;o.reverse(),t(o)},[n,t]);j.useEffect(()=>{c().then()},[c]);function a(r){return e.jsx(ce,{event:r},r.id)}return s===null?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsx("h1",{children:"Balance"}),s.map(a)]})},ie=()=>{const n=P();return e.jsx("div",{children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"top-header",children:[e.jsx("div",{className:"top-header-title",children:"Erc20 Payments Driver Dashboard"}),e.jsxs("div",{className:"top-header-navigation",children:[e.jsx(b,{to:"/",children:"Main"}),e.jsx(b,{to:"/feed",children:"Transaction feed"}),e.jsx(b,{to:"/accounts",children:"Accounts"}),e.jsx(b,{to:"/allowances",children:"Allowances"}),e.jsx(b,{to:"/balance/0x0000000600000006000000060000000600000006",children:"Balance"})]})]}),e.jsx("div",{className:"main-content",children:e.jsxs(R,{children:[e.jsx(y,{path:"/",element:e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"padding",children:[e.jsxs("p",{children:["Connected to payment driver API url:"," ",e.jsx("a",{href:I,children:I})]}),e.jsx("textarea",{style:{width:800,height:500},readOnly:!0,value:JSON.stringify(n,null,2)})]})})})}),e.jsx(y,{path:"feed",element:e.jsx(ee,{})}),e.jsx(y,{path:"accounts",element:e.jsx(se,{})}),e.jsx(y,{path:"allowances",element:e.jsx(ae,{})}),e.jsx(y,{path:"balance/:account",element:e.jsx(re,{})}),e.jsx(y,{path:"design_allowance_box",element:e.jsx(te,{})})]})})]}):"Loading config..."})},M=document.getElementById("root");if(!M)throw new Error("No root element found");const oe=U.createRoot(M);oe.render(e.jsx(j.StrictMode,{children:e.jsx(Q,{children:e.jsx(X,{children:e.jsx(R,{children:e.jsx(y,{path:"/*",element:e.jsx(ie,{})})})})})}));
